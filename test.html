function generateHTMLContent() {
    const name = (document.getElementById('projectName').value || 'AR_Project').trim();
    const bgColor = document.getElementById('bgColor').value;

    let htmlContent = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${name} - AR Experience</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"><\/script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"><\/script>
    <style>
        .ar-controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 999;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            color: white;
            text-align: center;
        }

        .ar-controls button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            background: #0066cc;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .ar-controls button:hover {
            background: #0052a3;
        }
    </style>
</head>

<body>
    <div class="ar-controls">
        <button onclick="playAllAnimations()">Play All Animations</button>
        <button onclick="stopAllAnimations()">Stop Animations</button>
    </div>

    <a-scene vr-mode-ui="enabled: false" embedded
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3; trackingMethod: best; maxDetectionRate: 60; canvasWidth: 640; canvasHeight: 480;"
        renderer="logarithmicDepthBuffer: true; colorManagement: true; sortObjects: true;"
        background="color: #000000; transparent: true">

        <a-assets>`;

    // Add audio asset if exists
    if (backgroundAudio) {
        htmlContent += `
            <audio id="background-audio" src="audio/${backgroundAudio.fileName}" loop autoplay></audio>`;
    }

    // Add image assets
    imageLayers.forEach(layer => {
        htmlContent += `
            <img id="img-${layer.id}" src="images/${layer.name}" crossorigin="anonymous">`;
    });

    htmlContent += `
        </a-assets>

        <a-marker type="pattern" url="pattern-${name}-qr-code.patt">`;

    // Add each layer as A-Frame entities with all settings
    imageLayers.forEach(layer => {
        const pos = layer.originalPosition;
        const rot = layer.originalRotation;
        const scale = layer.originalScale;
        const opacity = layer.originalOpacity;

        // Convert rotation from radians to degrees
        const rotX = (rot.x * 180 / Math.PI).toFixed(2);
        const rotY = (rot.y * 180 / Math.PI).toFixed(2);
        const rotZ = (rot.z * 180 / Math.PI).toFixed(2);

        // Properly escape JSON data for HTML attributes
        const customStartJSON = JSON.stringify(layer.customAnimation.start).replace(/"/g, '&quot;');
        const customEndJSON = JSON.stringify(layer.customAnimation.end).replace(/"/g, '&quot;');
        const specialEffectSettingsJSON = JSON.stringify(layer.specialEffectSettings).replace(/"/g, '&quot;');
        
        // Store original position as data attributes for animation reference
        const originalPosJSON = JSON.stringify(pos).replace(/"/g, '&quot;');
        const originalRotJSON = JSON.stringify(rot).replace(/"/g, '&quot;');
        const originalScaleJSON = JSON.stringify(scale).replace(/"/g, '&quot;');

        htmlContent += `
            <a-plane id="layer-${layer.id}" src="#img-${layer.id}"
                position="${pos.x.toFixed(2)} ${pos.y.toFixed(2)} ${pos.z.toFixed(2)}"
                rotation="${rotX} ${rotY} ${rotZ}"
                scale="${scale.x.toFixed(2)} ${scale.y.toFixed(2)} ${scale.z.toFixed(2)}"
                material="transparent: true; opacity: ${opacity.toFixed(2)}"
                data-animation-enabled="${layer.enableCustomAnimation}" 
                data-special-effect="${layer.specialEffect}"
                data-animation-speed="${layer.animationSpeed}" 
                data-animation-duration="${layer.animationDuration}"
                data-loop-animation="${layer.loopAnimation}"
                data-custom-start="${customStartJSON}"
                data-custom-end="${customEndJSON}"
                data-special-settings="${specialEffectSettingsJSON}"
                data-original-position="${originalPosJSON}"
                data-original-rotation="${originalRotJSON}"
                data-original-scale="${originalScaleJSON}"
                data-original-opacity="${opacity.toFixed(2)}">
            </a-plane>`;
    });

    htmlContent += `
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>