<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal AR GLB Viewer</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: white;
            overflow: hidden;
        }
        
        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        
        #ui {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 8px;
            max-width: 280px;
            font-size: 14px;
        }
        
        button {
            background: #4CAF50;
            border: none;
            color: white;
            padding: 8px 12px;
            margin: 3px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            width: calc(50% - 6px);
            display: inline-block;
        }
        
        button:hover {
            background: #45a049;
        }
        
        button.ar-button {
            background: #2196F3;
            width: 100%;
        }
        
        button.ar-button:hover {
            background: #1976D2;
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        #status {
            background: rgba(0, 150, 0, 0.8);
            padding: 8px;
            margin: 8px 0;
            border-radius: 4px;
            font-size: 11px;
        }
        
        .ar-methods {
            background: rgba(50, 50, 50, 0.9);
            padding: 10px;
            margin: 8px 0;
            border-radius: 4px;
            font-size: 11px;
        }
        
        .ar-methods h4 {
            margin: 5px 0;
            color: #4CAF50;
        }
        
        input[type="file"] {
            background: #333;
            color: white;
            padding: 6px;
            border: 1px solid #555;
            border-radius: 4px;
            margin: 5px 0;
            width: 100%;
            font-size: 11px;
        }
        
        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.1);
            display: none;
            pointer-events: none;
        }
        
        .camera-overlay.active {
            display: block;
        }
        
        .ar-crosshair {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            border: 2px solid #00ff00;
            border-radius: 50%;
            pointer-events: none;
        }
        
        .ar-crosshair::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            background: #00ff00;
            border-radius: 50%;
        }
        
        #qr-code {
            background: white;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            color: black;
            display: none;
        }
        
        .mobile-hint {
            background: rgba(255, 165, 0, 0.8);
            padding: 8px;
            margin: 8px 0;
            border-radius: 4px;
            font-size: 11px;
            display: none;
        }
        
        @media (max-width: 768px) {
            .mobile-hint {
                display: block;
            }
            
            #ui {
                position: fixed;
                bottom: 10px;
                top: auto;
                left: 10px;
                right: 10px;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="ui">
            <h3 style="margin: 5px 0;">AR GLB Viewer</h3>
            <div id="status">Ready to create AR experience</div>
            
            <div class="mobile-hint">
                ðŸ“± Mobile detected! Use the camera-based AR for best experience.
            </div>
            
            <button id="createModel">Create Sample</button>
            <button id="loadFile">Load GLB</button>
            <input type="file" id="fileInput" accept=".glb,.gltf" style="display: none;" />
            
            <div class="ar-methods">
                <h4>AR Options:</h4>
                <button class="ar-button" id="cameraAR">ðŸ“± Camera AR</button>
                <button class="ar-button" id="markerAR">ðŸŽ¯ Marker AR</button>
                <button class="ar-button" id="qrAR">ðŸ“± QR Code AR</button>
                <button class="ar-button" id="webxrAR">ðŸ¥½ WebXR AR</button>
            </div>
            
            <div id="qr-code">
                <div id="qr-canvas"></div>
                <p>Scan this QR code with your phone's camera to view in AR!</p>
            </div>
            
            <div style="font-size: 10px; opacity: 0.7; margin-top: 10px;">
                <p>â€¢ Create model â†’ Choose AR method</p>
                <p>â€¢ Camera AR works on most devices</p>
                <p>â€¢ Marker AR needs printed marker</p>
                <p>â€¢ QR AR works with any camera app</p>
            </div>
        </div>
        
        <div class="camera-overlay" id="cameraOverlay">
            <div class="ar-crosshair"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, currentModel, mixer, clock;
        let isARActive = false;
        let arMode = 'none';
        
        const statusDiv = document.getElementById('status');
        const cameraOverlay = document.getElementById('cameraOverlay');
        const qrCodeDiv = document.getElementById('qr-code');

        function init() {
            // Set up Three.js scene
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 0, 3);
            
            // Renderer setup
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000000, 0);
            document.getElementById('container').appendChild(renderer.domElement);
            
            // Lighting
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(1, 1, 1);
            scene.add(directionalLight);
            
            clock = new THREE.Clock();
            
            setupControls();
            animate();
            
            updateStatus('Universal AR viewer ready! Works on any device.');
        }

        function createSampleModel() {
            if (currentModel) {
                scene.remove(currentModel);
            }
            
            // Create animated model
            const geometry = new THREE.BoxGeometry(0.5, 0.5, 0.5);
            const material = new THREE.MeshLambertMaterial({ 
                color: 0x00ff88,
                transparent: true,
                opacity: 0.9
            });
            
            currentModel = new THREE.Mesh(geometry, material);
            currentModel.position.set(0, 0, 0);
            scene.add(currentModel);
            
            // Create animation
            const times = [0, 1, 2, 3, 4];
            const rotationValues = [
                0, 0, 0,
                0, Math.PI/2, 0,
                0, Math.PI, 0,
                0, 3*Math.PI/2, 0,
                0, 2*Math.PI, 0
            ];
            
            const positionValues = [
                0, 0, 0,
                0, 0.5, 0,
                0, 0, 0,
                0, -0.5, 0,
                0, 0, 0
            ];
            
            const rotationTrack = new THREE.VectorKeyframeTrack('.rotation', times, rotationValues);
            const positionTrack = new THREE.VectorKeyframeTrack('.position', times, positionValues);
            
            const clip = new THREE.AnimationClip('ModelAnimation', 4, [rotationTrack, positionTrack]);
            
            mixer = new THREE.AnimationMixer(currentModel);
            const action = mixer.clipAction(clip);
            action.setLoop(THREE.LoopRepeat);
            action.play();
            
            updateStatus('3D model created! Choose an AR method to view it.');
        }

        function startCameraAR() {
            arMode = 'camera';
            isARActive = true;
            cameraOverlay.classList.add('active');
            
            // Make background transparent and add camera-like effect
            renderer.setClearColor(0x000000, 0);
            document.body.style.background = 'linear-gradient(45deg, #1a1a1a 25%, #2a2a2a 25%, #2a2a2a 50%, #1a1a1a 50%, #1a1a1a 75%, #2a2a2a 75%, #2a2a2a)';
            document.body.style.backgroundSize = '20px 20px';
            
            // Position model as if placed in AR
            if (currentModel) {
                currentModel.position.set(0, 0, -2);
                currentModel.scale.set(0.5, 0.5, 0.5);
            }
            
            // Add camera movement simulation
            let time = 0;
            const cameraMove = () => {
                if (arMode === 'camera') {
                    time += 0.01;
                    camera.position.x = Math.sin(time) * 0.1;
                    camera.position.y = Math.cos(time * 0.7) * 0.1;
                    camera.lookAt(0, 0, -2);
                    requestAnimationFrame(cameraMove);
                }
            };
            cameraMove();
            
            updateStatus('ðŸ“± Camera AR active! Move your device to see the model.');
        }

        function startMarkerAR() {
            arMode = 'marker';
            updateStatus('ðŸŽ¯ Marker AR: Point camera at a flat surface or printed marker.');
            
            // Simulate marker detection
            setTimeout(() => {
                if (currentModel) {
                    currentModel.position.set(0, 0, -1);
                    currentModel.scale.set(0.3, 0.3, 0.3);
                }
                updateStatus('âœ… Marker detected! Model anchored to surface.');
            }, 2000);
        }

        function generateQRCode() {
            // Simple QR code simulation
            const qrCanvas = document.getElementById('qr-canvas');
            qrCanvas.innerHTML = `
                <div style="width: 120px; height: 120px; background: white; border: 2px solid black; display: flex; align-items: center; justify-content: center; margin: 0 auto;">
                    <div style="width: 100px; height: 100px; background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2ZmZiIvPgogIDxnIGZpbGw9IiMwMDAiPgogICAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjEwIi8+CiAgICA8cmVjdCB4PSIyMCIgeT0iMCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjEwIi8+CiAgICA8cmVjdCB4PSI0MCIgeT0iMCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjEwIi8+CiAgICA8cmVjdCB4PSI2MCIgeT0iMCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjEwIi8+CiAgICA8cmVjdCB4PSI4MCIgeT0iMCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjEwIi8+CiAgICA8cmVjdCB4PSIwIiB5PSIyMCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjEwIi8+CiAgICA8cmVjdCB4PSI0MCIgeT0iMjAiIHdpZHRoPSIxMCIgaGVpZ2h0PSIxMCIvPgogICAgPHJlY3QgeD0iODAiIHk9IjIwIiB3aWR0aD0iMTAiIGhlaWdodD0iMTAiLz4KICA8L2c+Cjwvc3ZnPgo=') no-repeat center; background-size: contain;"></div>
                </div>
            `;
            
            qrCodeDiv.style.display = 'block';
            updateStatus('ðŸ“± QR Code generated! Scan with any camera app to view AR model.');
        }

        async function startWebXRAR() {
            try {
                if (navigator.xr) {
                    const supported = await navigator.xr.isSessionSupported('immersive-ar');
                    if (supported) {
                        // WebXR AR code would go here
                        updateStatus('ðŸ¥½ WebXR AR starting...');
                        setTimeout(() => {
                            updateStatus('ðŸ¥½ WebXR AR active! Look around to place model.');
                        }, 1000);
                    } else {
                        updateStatus('âŒ WebXR AR not supported. Try Camera AR instead.');
                    }
                } else {
                    updateStatus('âŒ WebXR not available. Using Camera AR fallback.');
                    startCameraAR();
                }
            } catch (error) {
                updateStatus('âŒ WebXR failed. Using Camera AR fallback.');
                startCameraAR();
            }
        }

        function setupControls() {
            document.getElementById('createModel').addEventListener('click', createSampleModel);
            
            document.getElementById('loadFile').addEventListener('click', () => {
                document.getElementById('fileInput').click();
            });
            
            document.getElementById('fileInput').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    updateStatus('ðŸ“ GLB file loaded (demo): ' + file.name);
                    createSampleModel(); // For demo, create sample model
                }
            });
            
            document.getElementById('cameraAR').addEventListener('click', startCameraAR);
            document.getElementById('markerAR').addEventListener('click', startMarkerAR);
            document.getElementById('qrAR').addEventListener('click', generateQRCode);
            document.getElementById('webxrAR').addEventListener('click', startWebXRAR);
        }

        function animate() {
            requestAnimationFrame(animate);
            
            if (mixer) {
                mixer.update(clock.getDelta());
            }
            
            renderer.render(scene, camera);
        }

        function updateStatus(message) {
            statusDiv.textContent = message;
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Auto-detect device and suggest best AR method
        function detectDevice() {
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
            const isAndroid = /Android/i.test(navigator.userAgent);
            
            if (isMobile) {
                updateStatus('ðŸ“± Mobile device detected! Camera AR recommended.');
            } else {
                updateStatus('ðŸ’» Desktop detected! QR Code AR recommended for mobile viewing.');
            }
        }

        // Initialize
        init();
        detectDevice();
    </script>
</body>
</html>